<script lang="ts">
    import Translate from "../design/icons/Translate.svelte";
    import IconButton from "../design/IconButton.svelte";

    import type { Language } from "$lib/src/types";
    import { page } from "$app/state";
    import { goto } from "$app/navigation";
    import H2 from "../design/typography/H2.svelte";
    import H3 from "../design/typography/H3.svelte";

    const pathname = new URL(page.url).pathname;
    const language = (function get_language(): Language {
        if (pathname.startsWith("/en-US")) {
            return "en-US";
        }
        if (pathname.startsWith("/pt-BR")) {
            return "pt-BR";
        }
        return "en-US";
    })();

    let component: HTMLDialogElement | null = null;
</script>

<style>
    .header {
        background-color: var(--color-prm-90);
        display: flex;
        align-items: center;
        padding: 30px;
        column-gap: 1rem;
    }

    .footer {
        background-color: var(--color-prm-90);
        display: flex;
        padding: 30px;
        align-items: center;
        justify-content: end;
    }

    .content {
        display: flex;
        flex-direction: column;
        padding: 30px;
        row-gap: 1rem;
    }

    dialog {
        padding: 0;
        border: none;
        border-radius: 1rem;
        background-color: var(--color-prm-98);
    }

    dialog::backdrop {
        background-color: var(--color-prm-10);
        opacity: 0.5;
    }

    button {
        cursor: pointer;
        border: none;
        padding-top: 2rem;
        padding-bottom: 2rem;
        border-radius: 1rem;
        background-color: var(--color-prm-90);
    }

    button:hover {
        background-color: var(--color-prm-80);
    }

    button:active {
        background-color: var(--color-prm-70);
    }

    button:disabled {
        cursor: unset;
        background-color: var(--color-sec-90);
    }

    :global(.dark) {
        dialog {
            background-color: var(--color-prm-10);
        }

        dialog::backdrop {
            background-color: var(--color-prm-90);
            opacity: 0.5;
        }

        button {
            background-color: #ababab;
            color: white;
        }
    }
</style>

<IconButton
    onclick={() => {
        component.showModal();
    }}
>
    <Translate></Translate>
</IconButton>
<dialog bind:this={component}>
    <div class="header">
        <H2>Nova lingua</H2>
    </div>
    <div class="content">
        <button
            disabled={language === "en-US"}
            onclick={() => {
                goto(`/en-US/${page.url.pathname.slice(7)}`);
            }}
        >
            <H3 disabled={language === "en-US"}>ðŸ‡ºðŸ‡¸ English</H3>
        </button>
        <button
            disabled={language === "pt-BR"}
            onclick={() => {
                goto(`/pt-BR/${page.url.pathname.slice(7)}`);
            }}
        >
            <H3 disabled={language === "pt-BR"}>ðŸ‡§ðŸ‡· PortuguÃªs</H3>
        </button>
    </div>
    <div class="footer">
        <button
            onclick={() => {
                component?.close();
            }}
        >
            <H3>Fechar</H3>
        </button>
    </div>
</dialog>
